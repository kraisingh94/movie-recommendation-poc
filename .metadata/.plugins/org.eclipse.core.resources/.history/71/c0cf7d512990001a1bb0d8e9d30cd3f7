package com.infogain.service;

import java.util.Objects;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.infogain.entity.FollowingUserEntity;
import com.infogain.entity.RecommendEntity;
import com.infogain.repository.FollowingRepository;
import com.infogain.repository.RecommendRepository;

@Service
public class RecommendationService implements IRecommendService{

	@Autowired
	private RecommendRepository recommendRepository;
	
	@Autowired
	private FollowingRepository followingRepository;
	
	@Override
	public RecommendEntity updateUserLikedMovie(Integer userId, Integer movieId, boolean isLiked) {
		RecommendEntity recommendEntity = recommendRepository.findByUserIdAndMovieId(userId, movieId);
		if(!Objects.nonNull(recommendEntity)) {
			recommendEntity = new RecommendEntity();
			recommendEntity.setMovieId(movieId);
			recommendEntity.setUserId(userId);
		} 
		if(isLiked) {
			recommendEntity.setIsLiked(isLiked);
			recommendEntity.setIsDesliked(false);
		}
		else {
			recommendEntity.setIsLiked(false);
			recommendEntity.setIsDesliked(isLiked);
		}
		return recommendRepository.save(recommendEntity);
	}

	@Override
	public FollowingUserEntity updateFollowRequest(Integer followerId, Integer followingUserId) {
		FollowingUserEntity followingEntity = followingRepository.findByUserIdAndFollowingUserId(followerId, followingUserId);
		if(Objects.nonNull(followingEntity)) {
			followingEntity = new FollowingUserEntity(followerId, followingUserId);
			followingEntity = followingRepository.saveAndFlush(followingEntity);
		}
		return followingEntity;
	}
	
	@Override
	public void updateUnfollowRequest(Integer followerId, Integer followingUserId) {
		FollowingUserEntity followingEntity = followingRepository.findByUserIdAndFollowingUserId(followerId, followingUserId);
		if(Objects.nonNull(followingEntity)) {
			followingRepository.delete(followingEntity);
		}
	}

	
}
