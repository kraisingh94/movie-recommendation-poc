package com.infogain.repository;

import java.io.Serializable;
import java.util.List;

import org.springframework.data.jpa.repository.JpaRepository;
import org.springframework.data.jpa.repository.Query;
import org.springframework.stereotype.Repository;

import com.infogain.dto.MovieDTO;
import com.infogain.entity.RecommendEntity;

@Repository
public interface RecommendRepository extends JpaRepository<RecommendEntity, Serializable> {

	RecommendEntity findByUserIdAndMovieId(Integer userId, Integer movieId);

	List<RecommendEntity> findByUserIdInAndIsLiked(List<Integer> userIds, boolean isLiked);

	@Query(value = "SELECT NEW com.infogain.dto.MovieDTO(rm.movie_id as movieId, count(*) as likes) FROM recommend_metadata rm WHERE movie_id IN ?1 "
			+ "GROUP BY movie_id HAVING is_movie_liked=true ORDER BY count(*) DESC", nativeQuery = true)
	List<MovieDTO> getRecommendedTop5MovieIds(List<Integer> movieIds);
	
	@Query(value = "SELECT NEW com.infogain.dto.MovieDTO(movie_id as movieId, count(*) as likes) FROM recommend_metadata rm"
			+ "GROUP BY movie_id HAVING is_movie_liked=true ORDER BY count(*) DESC", nativeQuery = true)
	List<MovieDTO> getTop5MovieIds();

}
